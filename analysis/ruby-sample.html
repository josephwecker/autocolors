<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="3600" />
  <meta name="revisit-after" content="2 days" />
  <meta name="robots" content="index,follow" />
  <meta name="publisher" content="Dichodaemon" />
  <meta name="copyright" content="Dichodaemon" />

  <meta name="author" content="Dichodaemon" />
  <meta name="distribution" content="global" />
  <meta name="description" content="Ocatarinetabellachithchix" />
  <meta name="keywords" content="arzaversperia flexilimosos toves" />
  <link rel="stylesheet" type="text/css" media="screen,projection,print" href="css/brilliance_dull.css" />
  <title>brilliance_dull</title>

</head>

<body>
<pre class="brilliance_dull"><span class="line-numbers">   1 </span> <span class="Source"><span class="KeywordControl">module</span> <span class="Source">AutoColors</span></span>
<span class="line-numbers">   2 </span> <span class="Class">  <span class="KeywordControl">class</span> <span class="ClassName">ColorScheme</span></span>
<span class="line-numbers">   3 </span>     <span class="Source"><span class="FunctionCall">require</span> <span class="String"><span class="StringPunctuation">'</span>webster<span class="StringPunctuation">'</span></span></span>
<span class="line-numbers">   4 </span>     <span class="Source"><span class="FunctionCall">require</span> <span class="String"><span class="StringPunctuation">'</span>autocolors/color<span class="StringPunctuation">'</span></span></span>
<span class="line-numbers">   5 </span>     <span class="FunctionCall">attr_accessor</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>name</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>seed</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>contrast</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>saturation</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>dark</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>light</span>
<span class="line-numbers">   6 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">initialize</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">name<span class="KeywordOperatorAssignment">=</span><span class="BuiltInConstant">nil</span></span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers">   7 </span>       srand <span class="FunctionDeclaration"><span class="FunctionCall">rand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0xffffffff</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">   8 </span>       name <span class="KeywordOperatorAssignment">||=</span> <span class="LibraryClassType">Webster</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">new</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">random_word</span></span>
<span class="line-numbers">   9 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>name</span> <span class="KeywordOperatorAssignment">=</span> name
<span class="line-numbers">  10 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>seed</span> <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>name</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">hash</span></span>
<span class="line-numbers">  11 </span>       srand <span class="InstanceVariable"><span class="VariablePunctuation">@</span>seed</span>
<span class="line-numbers">  12 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>dark</span> <span class="KeywordOperatorAssignment">=</span> <span class="Source">{</span><span class="Source">}</span>
<span class="line-numbers">  13 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>light</span> <span class="KeywordOperatorAssignment">=</span> <span class="Source">{</span><span class="Source">}</span>
<span class="line-numbers">  14 </span>       generate
<span class="line-numbers">  15 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers">  16 </span> 
<span class="line-numbers">  17 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">generate</span></span>
<span class="line-numbers">  18 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> OVERALL CONTRAST: Value between 0.75 and 1.0 used to contract/spread</span>
<span class="line-numbers">  19 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> out intensity values.</span>
<span class="line-numbers">  20 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>contrast</span> <span class="KeywordOperatorAssignment">=</span>     <span class="FunctionDeclaration"><span class="FunctionCall">nrand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.95</span><span class="MiscPunctuation">,</span> <span class="Number">0.1</span><span class="MiscPunctuation">,</span> <span class="Number">0.75</span><span class="MiscPunctuation">,</span>  <span class="Number">1.1</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  21 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> OVERALL CHROMACITY: Value between 0.0 and 1.0 used to</span>
<span class="line-numbers">  22 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> contract/intensify colorfulness</span>
<span class="line-numbers">  23 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>chromacity</span> <span class="KeywordOperatorAssignment">=</span>   <span class="FunctionDeclaration"><span class="FunctionCall">nrand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.8</span><span class="MiscPunctuation">,</span>  <span class="Number">0.3</span><span class="MiscPunctuation">,</span>  <span class="Number">0.0</span><span class="MiscPunctuation">,</span>  <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  24 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> OVERALL COLORFULNESS: Value between 0.3 and 1.0 determining how many</span>
<span class="line-numbers">  25 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> hues overall end up in the colorscheme</span>
<span class="line-numbers">  26 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>colorfulness</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">nrand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.8</span><span class="MiscPunctuation">,</span>  <span class="Number">0.4</span><span class="MiscPunctuation">,</span>  <span class="Number">0.5</span><span class="MiscPunctuation">,</span>  <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  27 </span> 
<span class="line-numbers">  28 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>intensity</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand_seq</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.0</span><span class="MiscPunctuation">,</span> <span class="Number">1.0</span><span class="MiscPunctuation">,</span> <span class="Number">8</span><span class="MiscPunctuation">,</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>contrast</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">map</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">i</span><span class="Variable">|</span> <span class="FunctionDeclaration"><span class="FunctionCall">simplelogit</span></span><span class="FunctionCallArgumentsPunctuation">(</span>i<span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">*</span> <span class="Number">105</span><span class="Source">}</span>
<span class="line-numbers">  29 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>fcolor</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand_seq</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.0</span><span class="MiscPunctuation">,</span><span class="Number">100.0</span><span class="KeywordOperatorArithmetic">*</span><span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">sqrt</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">2.0</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="KeywordOperatorArithmetic">*</span><span class="InstanceVariable"><span class="VariablePunctuation">@</span>chromacity</span><span class="MiscPunctuation">,</span><span class="Number">8</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  30 </span> <span class="Comment">      <span class="VariablePunctuation">#</span>@fcolor = (0..7).map {|i| i.to_f / 7.0 * 100.0 * Math.sqrt(2.0) * @chromacity }</span>
<span class="line-numbers">  31 </span> 
<span class="line-numbers">  32 </span>       hues <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand_seq</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.0</span><span class="MiscPunctuation">,</span> <span class="Number">1.0</span><span class="MiscPunctuation">,</span> <span class="Number">10</span><span class="MiscPunctuation">,</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>colorfulness</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">shuffle</span></span>
<span class="line-numbers">  33 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span> <span class="KeywordOperatorAssignment">=</span> hues<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">map</span></span> <span class="KeywordControl">do </span><span class="Variable">|</span><span class="Variable">h</span><span class="Variable">|</span>
<span class="line-numbers">  34 </span>         c <span class="KeywordOperatorAssignment">=</span> <span class="LibraryClassType">Color</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">new</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="ArrayPunctuation">[</span><span class="Number">50</span><span class="MiscPunctuation">,</span> <span class="Number">60</span><span class="MiscPunctuation">,</span> <span class="Number">60</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  35 </span>         c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">hue</span></span> <span class="KeywordOperatorAssignment">=</span> h
<span class="line-numbers">  36 </span>         <span class="ArrayPunctuation">[</span>c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">ca</span></span><span class="MiscPunctuation">,</span> c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">cb</span></span><span class="MiscPunctuation">,</span> <span class="Number">1</span><span class="ArrayPunctuation">]</span>
<span class="line-numbers">  37 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers">  38 </span> 
<span class="line-numbers">  39 </span>       <span class="Source"><span class="FunctionCall">require</span> <span class="String"><span class="StringPunctuation">'</span>pp<span class="StringPunctuation">'</span></span></span>
<span class="line-numbers">  40 </span>       puts <span class="String"><span class="StringPunctuation">&quot;</span>Intensity<span class="StringPunctuation">&quot;</span></span>
<span class="line-numbers">  41 </span>       pp <span class="InstanceVariable"><span class="VariablePunctuation">@</span>intensity</span>
<span class="line-numbers">  42 </span>       puts <span class="String"><span class="StringPunctuation">&quot;</span>Chromacity<span class="StringPunctuation">&quot;</span></span>
<span class="line-numbers">  43 </span>       pp <span class="InstanceVariable"><span class="VariablePunctuation">@</span>fcolor</span>
<span class="line-numbers">  44 </span>       puts <span class="String"><span class="StringPunctuation">&quot;</span>Base Colors<span class="StringPunctuation">&quot;</span></span>
<span class="line-numbers">  45 </span>       pp <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span>
<span class="line-numbers">  46 </span> 
<span class="line-numbers">  47 </span>       do_concrete_mapping
<span class="line-numbers">  48 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers">  49 </span> 
<span class="line-numbers">  50 </span>     <span class="FunctionCall">protected</span>
<span class="line-numbers">  51 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">do_concrete_mapping</span></span>
<span class="line-numbers">  52 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>mapping</span> <span class="KeywordOperatorAssignment">=</span> <span class="LibraryClassType">Marshal</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">load</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="LibraryClassType">Marshal</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">dump</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="ConstantVariable">MAPPING</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  53 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>mapping</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">entries</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">each</span></span> <span class="KeywordControl">do </span><span class="Variable">|</span><span class="Variable">name</span><span class="Variable">,</span> <span class="Variable">entry</span><span class="Variable">|</span>
<span class="line-numbers">  54 </span>         <span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_idx</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_idx</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">each</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">k</span><span class="Variable">|</span> <span class="FunctionDeclaration"><span class="FunctionCall">concrete_index</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="MiscPunctuation">,</span>k<span class="FunctionCallArgumentsPunctuation">)</span><span class="Source">}</span>
<span class="line-numbers">  55 </span>         <span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_intensity</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_saturation</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_intensity</span><span class="MiscPunctuation">,</span> <span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_saturation</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">each</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">k</span><span class="Variable">|</span> <span class="FunctionDeclaration"><span class="FunctionCall">concrete_lvl</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="MiscPunctuation">,</span>k<span class="FunctionCallArgumentsPunctuation">)</span><span class="Source">}</span>
<span class="line-numbers">  56 </span>         <span class="FunctionDeclaration"><span class="FunctionCall">concrete_style</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  57 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers">  58 </span> 
<span class="line-numbers">  59 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>mapping</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">entries</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">each</span></span> <span class="KeywordControl">do </span><span class="Variable">|</span><span class="Variable">name</span><span class="Variable">,</span> <span class="Variable">entry</span><span class="Variable">|</span>
<span class="line-numbers">  60 </span>         ldat <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">dup</span></span>
<span class="line-numbers">  61 </span>         ddat <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">dup</span></span>
<span class="line-numbers">  62 </span>         fg_a<span class="MiscPunctuation">,</span> fg_b<span class="MiscPunctuation">,</span> _ <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_idx</span><span class="ArrayPunctuation">]</span><span class="ArrayPunctuation">]</span>
<span class="line-numbers">  63 </span>         bg_a<span class="MiscPunctuation">,</span> bg_b<span class="MiscPunctuation">,</span> _ <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_idx</span><span class="ArrayPunctuation">]</span><span class="ArrayPunctuation">]</span>
<span class="line-numbers">  64 </span>         ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">lab</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="FunctionDeclaration"><span class="FunctionCall">light_i</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_intensity</span><span class="ArrayPunctuation">]</span><span class="KeywordOperatorArithmetic">+</span><span class="Number">1</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> <span class="FunctionDeclaration"><span class="FunctionCall">light_s</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_saturation</span><span class="ArrayPunctuation">]</span><span class="KeywordOperatorArithmetic">+</span><span class="Number">2</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> fg_a<span class="MiscPunctuation">,</span> fg_b<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  65 </span>         ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">lab</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="FunctionDeclaration"><span class="FunctionCall">light_i</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_intensity</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> <span class="FunctionDeclaration"><span class="FunctionCall">light_s</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_saturation</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> bg_a<span class="MiscPunctuation">,</span> bg_b<span class="MiscPunctuation">,</span> <span class="BuiltInConstant">false</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  66 </span>         ddat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">lab</span></span><span class="FunctionCallArgumentsPunctuation">(</span> <span class="FunctionDeclaration"><span class="FunctionCall">dark_i</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_intensity</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span>  <span class="FunctionDeclaration"><span class="FunctionCall">dark_s</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>fg_saturation</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> fg_a<span class="MiscPunctuation">,</span> fg_b<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  67 </span>         ddat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">lab</span></span><span class="FunctionCallArgumentsPunctuation">(</span> <span class="FunctionDeclaration"><span class="FunctionCall">dark_i</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_intensity</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span>  <span class="FunctionDeclaration"><span class="FunctionCall">dark_s</span></span><span class="FunctionCallArgumentsPunctuation">(</span>ldat<span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>bg_saturation</span><span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> bg_a<span class="MiscPunctuation">,</span> bg_b<span class="MiscPunctuation">,</span> <span class="BuiltInConstant">false</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  68 </span>         <span class="InstanceVariable"><span class="VariablePunctuation">@</span>dark</span><span class="ArrayPunctuation">[</span>name<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> ddat
<span class="line-numbers">  69 </span>         <span class="InstanceVariable"><span class="VariablePunctuation">@</span>light</span><span class="ArrayPunctuation">[</span>name<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> ldat
<span class="line-numbers">  70 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers">  71 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers">  72 </span> 
<span class="line-numbers">  73 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">concrete_index</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">entry<span class="FunctionDeclarationParametersPunctuation">,</span> k</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers">  74 </span>       <span class="KeywordControl">return</span> <span class="KeywordControl">if</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">is_a?</span></span> <span class="ConstantVariable">Integer</span>
<span class="line-numbers">  75 </span>       primes <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">count</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="String"><span class="StringPunctuation">&quot;</span>'<span class="StringPunctuation">&quot;</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  76 </span>       entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">gsub!</span></span> <span class="String"><span class="StringPunctuation">&quot;</span>'<span class="StringPunctuation">&quot;</span></span><span class="MiscPunctuation">,</span><span class="String"><span class="StringPunctuation">'</span><span class="StringPunctuation">'</span></span>
<span class="line-numbers">  77 </span>       <span class="KeywordControl">if</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorComparison">=~</span> <span class="StringRegex"><span class="StringPunctuationIi">/</span></span><span class="StringRegex">^<span class="StringRegexGroup1"><span class="VariablePunctuation">(</span><span class="CharacterConstant">\d</span>+<span class="VariablePunctuation">)</span></span>$</span><span class="StringRegex"><span class="StringPunctuationIi">/</span></span> <span class="Comment"><span class="VariablePunctuation">#</span> Direct index</span>
<span class="line-numbers">  78 </span>         <span class="KeywordControl">if</span> primes <span class="KeywordOperatorComparison">&gt;</span> <span class="Number">0</span>
<span class="line-numbers">  79 </span>           entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">new_color</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="ConstantVariable">Integer</span><span class="FunctionCallArgumentsPunctuation">(</span><span class="GlobalPreDefinedVariable"><span class="VariablePunctuation">$</span>1</span><span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> primes<span class="MiscPunctuation">,</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">depth</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  80 </span>         <span class="KeywordControl">else</span> <span class="Comment"><span class="VariablePunctuation">#</span> Otherwise good to go</span>
<span class="line-numbers">  81 </span>           entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="ConstantVariable">Integer</span><span class="FunctionCallArgumentsPunctuation">(</span><span class="GlobalPreDefinedVariable"><span class="VariablePunctuation">$</span>1</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  82 </span>         <span class="KeywordControl">end</span>
<span class="line-numbers">  83 </span>       <span class="KeywordControl">elsif</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorComparison">=~</span> <span class="StringRegex"><span class="StringPunctuationIi">/</span></span><span class="StringRegex">^&lt;$</span><span class="StringRegex"><span class="StringPunctuationIi">/</span></span> <span class="Comment"><span class="VariablePunctuation">#</span> Inherit from parent</span>
<span class="line-numbers">  84 </span>         <span class="KeywordControl">if</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">nil?</span></span>
<span class="line-numbers">  85 </span>           <span class="GlobalVariable"><span class="VariablePunctuation">$</span>stderr</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">puts</span></span> <span class="String"><span class="StringPunctuation">&quot;</span>Mapping refers to parent without having a parent<span class="StringPunctuation">&quot;</span></span>
<span class="line-numbers">  86 </span>           <span class="FunctionDeclaration"><span class="FunctionCall">exit</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">2</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  87 </span>         <span class="KeywordControl">else</span>
<span class="line-numbers">  88 </span>           <span class="FunctionDeclaration"><span class="FunctionCall">concrete_index</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="MiscPunctuation">,</span> k<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  89 </span>           <span class="KeywordControl">if</span> primes <span class="KeywordOperatorComparison">==</span> <span class="Number">0</span> <span class="Comment"><span class="VariablePunctuation">#</span> Directly inherit</span>
<span class="line-numbers">  90 </span>             entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span>
<span class="line-numbers">  91 </span>           <span class="KeywordControl">else</span> <span class="Comment"><span class="VariablePunctuation">#</span> Modify a bit</span>
<span class="line-numbers">  92 </span>             entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">new_color</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="MiscPunctuation">,</span> primes<span class="MiscPunctuation">,</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">depth</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers">  93 </span>           <span class="KeywordControl">end</span>
<span class="line-numbers">  94 </span>         <span class="KeywordControl">end</span>
<span class="line-numbers">  95 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers">  96 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers">  97 </span> 
<span class="line-numbers">  98 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">concrete_lvl</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">entry<span class="FunctionDeclarationParametersPunctuation">,</span> k</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers">  99 </span>       <span class="KeywordControl">return</span> <span class="KeywordControl">if</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">is_a?</span></span> <span class="ConstantVariable">Integer</span>
<span class="line-numbers"> 100 </span>       c_parent <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">count</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="String"><span class="StringPunctuation">'</span>&lt;<span class="StringPunctuation">'</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 101 </span>       c_plus   <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">count</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="String"><span class="StringPunctuation">'</span>+<span class="StringPunctuation">'</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 102 </span>       c_minus  <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">count</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="String"><span class="StringPunctuation">'</span>-<span class="StringPunctuation">'</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 103 </span>       c_neut   <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">count</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="String"><span class="StringPunctuation">'</span>~<span class="StringPunctuation">'</span></span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 104 </span>       val <span class="KeywordOperatorAssignment">=</span> <span class="Number">0</span>
<span class="line-numbers"> 105 </span>       <span class="KeywordControl">if</span> c_parent <span class="KeywordOperatorComparison">==</span> <span class="Number">0</span>
<span class="line-numbers"> 106 </span>         val <span class="KeywordOperatorAssignment">=</span> <span class="Number">3</span> <span class="KeywordOperatorArithmetic">-</span> c_minus <span class="KeywordOperatorArithmetic">+</span> c_plus
<span class="line-numbers"> 107 </span>       <span class="KeywordControl">else</span>
<span class="line-numbers"> 108 </span>         <span class="FunctionDeclaration"><span class="FunctionCall">concrete_lvl</span></span><span class="FunctionCallArgumentsPunctuation">(</span>entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="MiscPunctuation">,</span> k<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 109 </span>         offset <span class="KeywordOperatorAssignment">=</span> entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">parent</span></span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 110 </span>         val <span class="KeywordOperatorAssignment">=</span> offset <span class="KeywordOperatorArithmetic">+</span> c_plus <span class="KeywordOperatorArithmetic">-</span> c_minus
<span class="line-numbers"> 111 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers"> 112 </span>       entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span>k<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span>val<span class="MiscPunctuation">,</span><span class="Number">7</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">min</span></span><span class="MiscPunctuation">,</span><span class="Number">0</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">max</span></span>
<span class="line-numbers"> 113 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 114 </span> 
<span class="line-numbers"> 115 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">concrete_style</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">entry</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 116 </span>       entry<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">data</span></span><span class="ArrayPunctuation">[</span><span class="UserDefinedConstant"><span class="VariablePunctuation">:</span>styles</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="String"><span class="StringPunctuation">'</span>NONE<span class="StringPunctuation">'</span></span>
<span class="line-numbers"> 117 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 118 </span> 
<span class="line-numbers"> 119 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">dark_i</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">idx</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>  <span class="InstanceVariable"><span class="VariablePunctuation">@</span>intensity</span><span class="ArrayPunctuation">[</span>idx<span class="ArrayPunctuation">]</span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 120 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">light_i</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">idx</span><span class="FunctionDeclarationParametersPunctuation">)</span></span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>intensity</span><span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span><span class="Number">7</span> <span class="KeywordOperatorArithmetic">-</span> idx<span class="MiscPunctuation">,</span><span class="Number">0</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">max</span></span><span class="MiscPunctuation">,</span><span class="Number">7</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">min</span></span><span class="ArrayPunctuation">]</span> <span class="KeywordControl">end</span>
<span class="line-numbers"> 121 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">dark_s</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">idx</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>  <span class="InstanceVariable"><span class="VariablePunctuation">@</span>fcolor</span><span class="ArrayPunctuation">[</span>idx<span class="ArrayPunctuation">]</span>        <span class="KeywordControl">end</span>
<span class="line-numbers"> 122 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">light_s</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">idx</span><span class="FunctionDeclarationParametersPunctuation">)</span></span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>fcolor</span><span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span>idx<span class="MiscPunctuation">,</span><span class="Number">7</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">min</span></span><span class="ArrayPunctuation">]</span>        <span class="KeywordControl">end</span>
<span class="line-numbers"> 123 </span>   
<span class="line-numbers"> 124 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">lab</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">intensity<span class="FunctionDeclarationParametersPunctuation">,</span> chroma<span class="FunctionDeclarationParametersPunctuation">,</span> a<span class="FunctionDeclarationParametersPunctuation">,</span> b<span class="FunctionDeclarationParametersPunctuation">,</span> rand_adjust<span class="KeywordOperatorAssignment">=</span><span class="BuiltInConstant">true</span></span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 125 </span>       ivar <span class="KeywordOperatorAssignment">=</span> rand_adjust <span class="KeywordOperatorComparison">?</span> <span class="FunctionCallArgumentsPunctuation">(</span><span class="InstanceVariable"><span class="VariablePunctuation">@</span>colorfulness</span> <span class="KeywordOperatorArithmetic">*</span> rand <span class="KeywordOperatorArithmetic">*</span> <span class="Number">16</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">-</span> <span class="Number">8</span> <span class="Source">:</span> <span class="Number">0</span>
<span class="line-numbers"> 126 </span>       c <span class="KeywordOperatorAssignment">=</span> <span class="LibraryClassType">Color</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">new</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span>intensity <span class="KeywordOperatorArithmetic">+</span> ivar<span class="MiscPunctuation">,</span><span class="Number">0</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">max</span></span><span class="MiscPunctuation">,</span><span class="Number">140</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">min</span></span><span class="MiscPunctuation">,</span> a<span class="MiscPunctuation">,</span> b<span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 127 </span>       c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">chroma</span></span> <span class="KeywordOperatorAssignment">=</span> chroma
<span class="line-numbers"> 128 </span>       <span class="KeywordControl">return</span> c
<span class="line-numbers"> 129 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 130 </span> 
<span class="line-numbers"> 131 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">new_color</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">base_idx<span class="FunctionDeclarationParametersPunctuation">,</span> diff_level<span class="FunctionDeclarationParametersPunctuation">,</span> depth</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 132 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> TODO: Use actual mapping metrics for very even spread</span>
<span class="line-numbers"> 133 </span>       a<span class="MiscPunctuation">,</span> b<span class="MiscPunctuation">,</span> count <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>base_idx<span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 134 </span>       c <span class="KeywordOperatorAssignment">=</span> <span class="LibraryClassType">Color</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">new</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="ArrayPunctuation">[</span><span class="Number">50</span><span class="MiscPunctuation">,</span> a<span class="MiscPunctuation">,</span> b<span class="ArrayPunctuation">]</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 135 </span>       current_hue <span class="KeywordOperatorAssignment">=</span> c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">hue</span></span>
<span class="line-numbers"> 136 </span>       diff_level <span class="KeywordOperatorAssignment">=</span> diff_level<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span>  <span class="Comment"><span class="VariablePunctuation">#</span> Usually 1 or 2 - from prime marks</span>
<span class="line-numbers"> 137 </span>       depth <span class="KeywordOperatorAssignment">=</span> depth<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span>            <span class="Comment"><span class="VariablePunctuation">#</span> Usually 1, less frequently 2, 3, to 5...</span>
<span class="line-numbers"> 138 </span>       count <span class="KeywordOperatorAssignment">=</span> count<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span>            <span class="Comment"><span class="VariablePunctuation">#</span> How many others already based off of the same parent</span>
<span class="line-numbers"> 139 </span>       direction <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">2</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorComparison">==</span> <span class="Number">1</span> <span class="KeywordOperatorComparison">?</span> <span class="KeywordOperatorArithmetic">-</span><span class="Number">1.0</span> <span class="Source">:</span> <span class="Number">1.0</span>
<span class="line-numbers"> 140 </span> 
<span class="line-numbers"> 141 </span>       maxdiff <span class="KeywordOperatorAssignment">=</span> <span class="Number">1.0</span> <span class="KeywordOperatorArithmetic">/</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">size</span></span>  <span class="Comment"><span class="VariablePunctuation">#</span> allocated roughly per major color group</span>
<span class="line-numbers"> 142 </span>       dist <span class="KeywordOperatorAssignment">=</span> diff_level <span class="KeywordOperatorArithmetic">*</span> count <span class="KeywordOperatorArithmetic">*</span> direction <span class="KeywordOperatorArithmetic">*</span> maxdiff <span class="KeywordOperatorArithmetic">/</span> <span class="FunctionCallArgumentsPunctuation">(</span><span class="FunctionCallArgumentsPunctuation">(</span>depth <span class="KeywordOperatorArithmetic">+</span> <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">/</span> <span class="Number">6.0</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 143 </span> 
<span class="line-numbers"> 144 </span> <span class="Comment">      <span class="VariablePunctuation">#</span>cdiff = direction * maxdiff / (depth+0.5) * count * 2.5 * diff_level</span>
<span class="line-numbers"> 145 </span> <span class="Comment">      <span class="VariablePunctuation">#</span>cdiff += current_hue</span>
<span class="line-numbers"> 146 </span> 
<span class="line-numbers"> 147 </span> <span class="Comment">      <span class="VariablePunctuation">#</span> Rotate it</span>
<span class="line-numbers"> 148 </span>       dist <span class="KeywordOperatorAssignment">=</span> <span class="Number">1.0</span> <span class="KeywordOperatorArithmetic">+</span> dist <span class="KeywordControl">if</span> dist <span class="KeywordOperatorComparison">&lt;</span> <span class="Number">0.0</span>
<span class="line-numbers"> 149 </span>       dist <span class="KeywordOperatorAssignment">=</span> dist <span class="KeywordOperatorArithmetic">-</span> <span class="Number">1.0</span> <span class="KeywordControl">if</span> dist <span class="KeywordOperatorComparison">&gt;</span> <span class="Number">1.0</span>
<span class="line-numbers"> 150 </span>       c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">hue</span></span> <span class="KeywordOperatorAssignment">=</span> dist <span class="KeywordOperatorArithmetic">+</span> current_hue
<span class="line-numbers"> 151 </span>       new_idx <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">size</span></span>
<span class="line-numbers"> 152 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>new_idx<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="ArrayPunctuation">[</span>c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">ca</span></span><span class="MiscPunctuation">,</span> c<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">cb</span></span><span class="MiscPunctuation">,</span> <span class="Number">1</span><span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 153 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>base_idx<span class="ArrayPunctuation">]</span><span class="ArrayPunctuation">[</span><span class="Number">2</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">+=</span> <span class="Number">1</span>
<span class="line-numbers"> 154 </span>       <span class="KeywordControl">return</span> new_idx
<span class="line-numbers"> 155 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 156 </span> 
<span class="line-numbers"> 157 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">new_color_old</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">base_idx<span class="FunctionDeclarationParametersPunctuation">,</span> diff_level<span class="FunctionDeclarationParametersPunctuation">,</span> depth</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 158 </span>       a<span class="MiscPunctuation">,</span>b<span class="MiscPunctuation">,</span>count <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>base_idx<span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 159 </span>       base_diff <span class="KeywordOperatorAssignment">=</span> <span class="FunctionCallArgumentsPunctuation">(</span>diff_level<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span> <span class="KeywordOperatorArithmetic">+</span> <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">*</span> <span class="Number">4.0</span> <span class="KeywordOperatorArithmetic">/</span> <span class="FunctionCallArgumentsPunctuation">(</span><span class="FunctionCallArgumentsPunctuation">(</span>depth<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span> <span class="KeywordOperatorArithmetic">+</span> <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">/</span> <span class="Number">2.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">*</span> count<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span>
<span class="line-numbers"> 160 </span>       a_dir <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">2</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorComparison">==</span> <span class="Number">1</span> <span class="KeywordOperatorComparison">?</span> <span class="KeywordOperatorArithmetic">-</span><span class="Number">1.0</span> <span class="Source">:</span> <span class="Number">1.0</span>
<span class="line-numbers"> 161 </span>       b_dir <span class="KeywordOperatorAssignment">=</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">2</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorComparison">==</span> <span class="Number">1</span> <span class="KeywordOperatorComparison">?</span> <span class="KeywordOperatorArithmetic">-</span><span class="Number">1.0</span> <span class="Source">:</span> <span class="Number">1.0</span>
<span class="line-numbers"> 162 </span>       a_p <span class="KeywordOperatorAssignment">=</span> a <span class="KeywordOperatorArithmetic">+</span> <span class="FunctionCallArgumentsPunctuation">(</span>base_diff <span class="KeywordOperatorArithmetic">*</span> a_dir<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 163 </span>       b_p <span class="KeywordOperatorAssignment">=</span> b <span class="KeywordOperatorArithmetic">+</span> <span class="FunctionCallArgumentsPunctuation">(</span>base_diff <span class="KeywordOperatorArithmetic">*</span> b_dir<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 164 </span>       new_idx <span class="KeywordOperatorAssignment">=</span> <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">size</span></span>
<span class="line-numbers"> 165 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>new_idx<span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">=</span> <span class="ArrayPunctuation">[</span>a_p<span class="MiscPunctuation">,</span> b_p<span class="MiscPunctuation">,</span> <span class="Number">1</span><span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 166 </span>       <span class="InstanceVariable"><span class="VariablePunctuation">@</span>base_colors</span><span class="ArrayPunctuation">[</span>base_idx<span class="ArrayPunctuation">]</span><span class="ArrayPunctuation">[</span><span class="Number">2</span><span class="ArrayPunctuation">]</span> <span class="KeywordOperatorAssignment">+=</span> <span class="Number">1</span>
<span class="line-numbers"> 167 </span>       <span class="KeywordControl">return</span> new_idx
<span class="line-numbers"> 168 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 169 </span> 
<span class="line-numbers"> 170 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">rand_color</span></span><span class="MiscPunctuation">;</span> <span class="FunctionDeclaration"><span class="FunctionCall">rand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">180</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">-</span> <span class="Number">90</span> <span class="KeywordControl">end</span>
<span class="line-numbers"> 171 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">nrand_color</span></span><span class="MiscPunctuation">;</span> <span class="FunctionDeclaration"><span class="FunctionCall">nrand</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">0.0</span><span class="MiscPunctuation">,</span> <span class="Number">40.0</span><span class="MiscPunctuation">,</span> <span class="KeywordOperatorArithmetic">-</span><span class="Number">120.0</span><span class="MiscPunctuation">,</span> <span class="Number">120.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordControl">end</span>
<span class="line-numbers"> 172 </span> 
<span class="line-numbers"> 173 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">nrand</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">mean<span class="KeywordOperatorAssignment">=</span><span class="Number">0</span><span class="FunctionDeclarationParametersPunctuation">,</span> stddev<span class="KeywordOperatorAssignment">=</span><span class="BuiltInConstant">nil</span><span class="FunctionDeclarationParametersPunctuation">,</span> floor<span class="KeywordOperatorAssignment">=</span><span class="BuiltInConstant">nil</span><span class="FunctionDeclarationParametersPunctuation">,</span> ceil<span class="KeywordOperatorAssignment">=</span><span class="BuiltInConstant">nil</span></span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 174 </span>       theta <span class="KeywordOperatorAssignment">=</span> <span class="Number">2</span> <span class="KeywordOperatorArithmetic">*</span> <span class="LibraryClassType">Math</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">::</span><span class="FunctionCallWithoutArguments">PI</span></span> <span class="KeywordOperatorArithmetic">*</span> rand
<span class="line-numbers"> 175 </span>       rho <span class="KeywordOperatorAssignment">=</span> <span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">sqrt</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="KeywordOperatorArithmetic">-</span><span class="Number">2</span> <span class="KeywordOperatorArithmetic">*</span> <span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">log</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">1</span> <span class="KeywordOperatorArithmetic">-</span> rand<span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 176 </span>       scale <span class="KeywordOperatorAssignment">=</span> stddev <span class="KeywordOperatorArithmetic">*</span> rho
<span class="line-numbers"> 177 </span>       res <span class="KeywordOperatorAssignment">=</span> <span class="FunctionCallArgumentsPunctuation">(</span>rand <span class="KeywordOperatorComparison">&gt;=</span> <span class="Number">0.5</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorComparison">?</span> <span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">cos</span></span><span class="FunctionCallArgumentsPunctuation">(</span>theta<span class="FunctionCallArgumentsPunctuation">)</span> <span class="Source">:</span> <span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">sin</span></span><span class="FunctionCallArgumentsPunctuation">(</span>theta<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 178 </span>       res <span class="KeywordOperatorAssignment">=</span> mean<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span> <span class="KeywordOperatorArithmetic">+</span> scale <span class="KeywordOperatorArithmetic">*</span> res
<span class="line-numbers"> 179 </span>       res <span class="KeywordOperatorAssignment">=</span> floor <span class="KeywordControl">if</span> <span class="FunctionCallArgumentsPunctuation">(</span>! floor<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">nil?</span></span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorLogical">&amp;&amp;</span> <span class="FunctionCallArgumentsPunctuation">(</span>res <span class="KeywordOperatorComparison">&lt;</span> floor<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 180 </span>       res <span class="KeywordOperatorAssignment">=</span> ceil  <span class="KeywordControl">if</span> <span class="FunctionCallArgumentsPunctuation">(</span>! ceil<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">nil?</span></span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorLogical">&amp;&amp;</span> <span class="FunctionCallArgumentsPunctuation">(</span>res <span class="KeywordOperatorComparison">&gt;</span> ceil<span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 181 </span>       <span class="KeywordControl">return</span> res
<span class="line-numbers"> 182 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 183 </span>     
<span class="line-numbers"> 184 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">rand_seq</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">min<span class="FunctionDeclarationParametersPunctuation">,</span> max<span class="FunctionDeclarationParametersPunctuation">,</span> points<span class="FunctionDeclarationParametersPunctuation">,</span> contraction<span class="KeywordOperatorAssignment">=</span><span class="Number">1.0</span></span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 185 </span>       max <span class="KeywordOperatorAssignment">=</span> max<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span><span class="MiscPunctuation">;</span> min <span class="KeywordOperatorAssignment">=</span> min<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span><span class="MiscPunctuation">;</span> contraction <span class="KeywordOperatorAssignment">=</span> contraction<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span>
<span class="line-numbers"> 186 </span>       spread <span class="KeywordOperatorAssignment">=</span> max <span class="KeywordOperatorArithmetic">-</span> min
<span class="line-numbers"> 187 </span>       base_step <span class="KeywordOperatorAssignment">=</span> spread <span class="KeywordOperatorArithmetic">/</span> <span class="FunctionCallArgumentsPunctuation">(</span>points<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span> <span class="KeywordOperatorArithmetic">-</span> <span class="Number">1.0</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">*</span> contraction
<span class="line-numbers"> 188 </span>       partial <span class="KeywordOperatorAssignment">=</span> base_step <span class="KeywordOperatorArithmetic">/</span> <span class="Number">3.0</span>
<span class="line-numbers"> 189 </span>       curr <span class="KeywordOperatorAssignment">=</span> <span class="Number">0.0</span>
<span class="line-numbers"> 190 </span>       res <span class="KeywordOperatorAssignment">=</span> <span class="ArrayPunctuation">[</span>curr<span class="ArrayPunctuation">]</span>
<span class="line-numbers"> 191 </span>       <span class="KeywordControl">while</span> res<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">size</span></span> <span class="KeywordOperatorComparison">&lt;</span> points
<span class="line-numbers"> 192 </span>         curr <span class="KeywordOperatorAssignment">+=</span> <span class="FunctionDeclaration"><span class="FunctionCall">nrand</span></span><span class="FunctionCallArgumentsPunctuation">(</span>base_step<span class="MiscPunctuation">,</span> partial <span class="KeywordOperatorArithmetic">/</span> <span class="Number">2.0</span><span class="MiscPunctuation">,</span> base_step <span class="KeywordOperatorArithmetic">-</span> <span class="FunctionCallArgumentsPunctuation">(</span>partial<span class="FunctionCallArgumentsPunctuation">)</span><span class="MiscPunctuation">,</span> base_step <span class="KeywordOperatorArithmetic">+</span> <span class="FunctionCallArgumentsPunctuation">(</span>partial<span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallArgumentsPunctuation">)</span>
<span class="line-numbers"> 193 </span>         res <span class="KeywordOperatorAssignment">&lt;&lt;</span> curr
<span class="line-numbers"> 194 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers"> 195 </span>       <span class="KeywordControl">if</span> curr <span class="KeywordOperatorComparison">&gt;</span> spread
<span class="line-numbers"> 196 </span>         factor <span class="KeywordOperatorAssignment">=</span> spread <span class="KeywordOperatorArithmetic">/</span> curr
<span class="line-numbers"> 197 </span>         res<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">map!</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">v</span><span class="Variable">|</span> factor <span class="KeywordOperatorArithmetic">*</span> v<span class="Source">}</span>
<span class="line-numbers"> 198 </span>       <span class="KeywordControl">else</span>
<span class="line-numbers"> 199 </span>         offset <span class="KeywordOperatorAssignment">=</span> <span class="FunctionCallArgumentsPunctuation">(</span>spread <span class="KeywordOperatorArithmetic">-</span> curr<span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">*</span> rand
<span class="line-numbers"> 200 </span>         res<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">map!</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">v</span><span class="Variable">|</span> offset <span class="KeywordOperatorArithmetic">+</span> v<span class="Source">}</span>
<span class="line-numbers"> 201 </span>       <span class="KeywordControl">end</span>
<span class="line-numbers"> 202 </span>       <span class="KeywordControl">return</span> res<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">map</span></span><span class="Source">{</span><span class="Variable">|</span><span class="Variable">v</span><span class="Variable">|</span> v <span class="KeywordOperatorArithmetic">+</span> min<span class="Source">}</span>
<span class="line-numbers"> 203 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 204 </span> 
<span class="line-numbers"> 205 </span> <span class="Comment">    <span class="VariablePunctuation">#</span> (inverse s-curve, steepest on edges)</span>
<span class="line-numbers"> 206 </span>     <span class="FunctionDeclaration"><span class="KeywordControl">def</span> <span class="FunctionDeclarationName">simplelogit</span><span class="FunctionDeclarationParametersPunctuation">(</span><span class="FunctionDeclarationParameters1">x</span><span class="FunctionDeclarationParametersPunctuation">)</span></span>
<span class="line-numbers"> 207 </span>       <span class="KeywordControl">return</span> <span class="Number">0.0</span> <span class="KeywordControl">if</span> x <span class="KeywordOperatorComparison">&lt;=</span> <span class="Number">0.0</span>
<span class="line-numbers"> 208 </span>       <span class="KeywordControl">return</span> <span class="Number">1.0</span> <span class="KeywordControl">if</span> x <span class="KeywordOperatorComparison">&gt;=</span> <span class="Number">1.0</span>
<span class="line-numbers"> 209 </span>       <span class="ArrayPunctuation">[</span><span class="ArrayPunctuation">[</span><span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">log</span></span><span class="FunctionCallArgumentsPunctuation">(</span>x<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span> <span class="KeywordOperatorArithmetic">/</span> <span class="FunctionCallArgumentsPunctuation">(</span><span class="Number">1.0</span> <span class="KeywordOperatorArithmetic">-</span> x<span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">to_f</span></span><span class="FunctionCallArgumentsPunctuation">)</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">/</span> <span class="LibraryClassType">Math</span><span class="FunctionDeclaration"><span class="MetaDelimiter">.</span><span class="FunctionCall">log</span></span><span class="FunctionCallArgumentsPunctuation">(</span><span class="LibraryClassType">Math</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">::</span><span class="FunctionCallWithoutArguments">E</span></span> <span class="KeywordOperatorArithmetic">**</span> <span class="Number">4.5</span><span class="FunctionCallArgumentsPunctuation">)</span> <span class="KeywordOperatorArithmetic">+</span> <span class="Number">0.5</span><span class="MiscPunctuation">,</span><span class="Number">0.0</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">max</span></span><span class="MiscPunctuation">,</span><span class="Number">1.0</span><span class="ArrayPunctuation">]</span><span class="FunctionCallWithoutArguments"><span class="MetaDelimiter">.</span><span class="FunctionCallWithoutArguments">min</span></span>
<span class="line-numbers"> 210 </span>     <span class="KeywordControl">end</span>
<span class="line-numbers"> 211 </span>   <span class="KeywordControl">end</span>
<span class="line-numbers"> 212 </span> <span class="KeywordControl">end</span>
</pre>  <p>
    <a href="http://validator.w3.org/check?uri=referer">
      <img style="border:0"
           src="http://www.w3.org/Icons/valid-xhtml10"
           alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="http://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
           src="http://jigsaw.w3.org/css-validator/images/vcss" 
           alt="Valid CSS!" />
    </a>
  </p>
</body>
</html>
